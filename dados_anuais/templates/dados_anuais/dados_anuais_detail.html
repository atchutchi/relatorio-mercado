{% extends 'base.html' %}
{% load humanize %}
{% load static %}
{% load custom_filters %}

{% block content %}
<div class="content-wrapper" style="margin-top: 200px;">
    <div class="container mt-4">
        <h1 class="text-center mb-4">Detalhes de {{ dados.ano }} - {{ dados.get_operadora_display }}</h1>
        
        <div class="row mb-4">
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Assinantes Rede Móvel</h5>
                        <p class="card-text h4">{{ dados.assinantes_rede_movel|intcomma }}</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Volume de Negócio</h5>
                        <p class="card-text h4">{{ dados.volume_negocio|floatformat:2|intcomma }} FCFA</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Investimentos</h5>
                        <p class="card-text h4">{{ dados.investimentos|floatformat:2|intcomma }} FCFA</p>
                    </div>
                </div>
            </div>
            <div class="col-md-3">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Receita Total</h5>
                        <p class="card-text h4">{{ dados.receita_total|floatformat:2|intcomma }} FCFA</p>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Assinantes por Tecnologia</h2>
                        <canvas id="assinantesTecnologiaChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Tráfego de Voz</h2>
                        <canvas id="trafegoVozChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="row">
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Tráfego de Dados</h2>
                        <canvas id="trafegoDadosChart"></canvas>
                    </div>
                </div>
            </div>
            <div class="col-md-6 mb-4">
                <div class="card">
                    <div class="card-body">
                        <h2 class="card-title">Distribuição de Receitas</h2>
                        <canvas id="receitasChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <div class="card mb-4">
            <div class="card-body">
                <h2 class="card-title">Informações Detalhadas</h2>
                <div class="table-responsive">
                    <table class="table table-striped">
                        {% for campo in campos %}
                        <tr>
                            <th>{{ campo|title|replace_underscore }}</th>
                            <td>
                                {% if 'volume_negocio' in campo or 'receita' in campo or 'investimentos' in campo %}
                                    {{ dados|getattr_filter:campo|floatformat:2|intcomma }} FCFA
                                {% else %}
                                    {{ dados|getattr_filter:campo|intcomma }}
                                {% endif %}
                            </td>
                        </tr>
                        {% endfor %}
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    var dadosDetalhados = {
        assinantes_3g: {{ dados.assinantes_3g }},
        assinantes_4g: {{ dados.assinantes_4g }},
        assinantes_3g_box: {{ dados.assinantes_3g_box }},
        assinantes_3g_usb: {{ dados.assinantes_3g_usb }},
        assinantes_4g_box: {{ dados.assinantes_4g_box }},
        assinantes_4g_usb: {{ dados.assinantes_4g_usb }},
        trafego_voz_on_net: {{ dados.trafego_voz_on_net }},
        trafego_voz_off_net: {{ dados.trafego_voz_off_net }},
        trafego_voz_internacional: {{ dados.trafego_voz_internacional }},
        trafego_dados_2g: {{ dados.trafego_dados_2g }},
        trafego_dados_3g: {{ dados.trafego_dados_3g }},
        trafego_dados_4g: {{ dados.trafego_dados_4g }},
        receita_servicos_voz: {{ dados.receita_servicos_voz }},
        receita_servicos_mensagens: {{ dados.receita_servicos_mensagens }},
        receita_dados_moveis: {{ dados.receita_dados_moveis }},
        receita_roaming_out: {{ dados.receita_roaming_out }}
    };
</script>
<script src="{% static 'js/dados_anuais_detail.js' %}"></script>
{% endblock %}